language: java
addons:
  sonarqube: true
jdk:
  - oraclejdk8
before_install:
  - if [ ! -z "$GPG_SECRET_KEYS" ]; then echo $GPG_SECRET_KEYS | base64 --decode | $GPG_EXECUTABLE --import; fi
  - if [ ! -z "$GPG_OWNERTRUST" ]; then echo $GPG_OWNERTRUST | base64 --decode | $GPG_EXECUTABLE --import-ownertrust; fi
install:
  - mvn --settings .travis/settings.xml clean install -DskipTests=true -Dmaven.javadoc.skip=true -Dgpg.skip -B -V
script:
  - mvn --settings .travis/settings.xml org.jacoco:jacoco-maven-plugin:prepare-agent sonar:sonar -Dsonar.login=$SONAR_TOKEN
deploy:
  - provider: script
    script: ".travis/deploy.sh"
    skip_cleanup: true
    on:
      repo: sbtqa/video-recorder
      branch: master
      jdk: oraclejdk8
  - provider: script
    script: ".travis/deploy.sh"
    skip_cleanup: true
    on:
      repo: sbtqa/video-recorder
      tags: true
      jdk: oraclejdk8
notifications:
  email: false
  slack:
    rooms:
      - secure: L1w6jw7P1eZr8HGFlOu7l+RrD6iZ0G73FLu2wvCOiYWn+MhcpYG0678i1lPjGsNHJl3Dwnki83Yff0ADhYBnL/OKRI9jRBOFlfzsXDk3gB+EPMBpt5fCDRlC4WW6In7USdwS7gjMUCQgoNVibcEs6IZL8AbFOReEAS64XY97KoQLyGMssI4T8V97xWEUJxPnrYFT5XdHhPpOujH2+8qGrhJA4Ny1FWcqwqsdG7O8Zjhj8nPdJb+dwQ9lcHqNWOIiONx5gr9hyezKf2oJKlUbSS73X5V+BLKqD21ALbCY4g59hIbQ3VoV7jux2z4gVby4AibyW8LuQCFaDWqxEjvEhHU6omEETgVsMtRJGYIN3z8/Ljme/ZmjCdM35oEw9all7wF8srz/rZIR7LeFvT7MLvR0lXsfqrILsbcG/Ru5S5+XKbmv/FEoUtZp+rRMUTHHS5o8VOJaD7tSMg5+EOo+eJxpQzSmhAzrvuIFU8v06q31TpPw+gUdBuqG8QxTSnfuLtFOtj/AzGRGfJGrUymvlkp/l09/DuR7wwRz0z3p7r0xq1rRoeH6wXBP3LqVTriA4ta4HUMFsMlQz30N1rfDK78UAP2b5QAhrKulVOJYnnSFScZ2Y6Bc0nD1WoyvbAnZJFJd0PIKfZ93WYiy6LD+ESmlSD6hQGJFXbtTwxzpon4=
    template:
      - "Build status: %{message}"
      - "%{repository}#%{build_number} (%{branch} - %{commit} : %{author}): %{commit_message}"
      - "Change view : %{compare_url}"
      - "Build details : %{build_url}"